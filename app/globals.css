@tailwind base;
@tailwind components;
@tailwind utilities;
@import 'leaflet/dist/leaflet.css';

/* ---------- Leaflet pane ordering ---------- */
.leaflet-tile-pane      { z-index: 200 !important; }
.leaflet-overlay-pane   { z-index: 400 !important; }
.leaflet-marker-pane    { z-index: 600 !important; }
.leaflet-popup-pane     { z-index: 700 !important; }
.leaflet-top, .leaflet-bottom { z-index: 800 !important; }

/* ---------- Modal ---------- */
.cpm-backdrop {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 2000 !important;
}
.cpm-modal {
  position: fixed; right: 0; top: 0;
  height: 100vh; width: min(420px,100vw);
  background:#fff; z-index: 2100 !important;
  display:flex; flex-direction:column;
  box-shadow:-14px 0 40px rgba(0,0,0,.25);
}
.cpm-modal__header {
  padding: 14px 16px;
  border-bottom: 1px solid #eee;
  display:flex; align-items:center; justify-content:space-between;
}
.cpm-modal__body { padding: 12px 16px; overflow:auto; }

/* ---------- Clusters & markers ---------- */
.cluster-green  { background:#86efac; border:3px solid #22c55e; color:#14532d; }
.cluster-yellow { background:#fde68a; border:3px solid #f59e0b; color:#713f12; }
.cluster-orange { background:#fdba74; border:3px solid #f97316; color:#7c2d12; }
.cluster-red    { background:#fca5a5; border:3px solid #ef4444; color:#7f1d1d; }
.cluster {
  border-radius:9999px;
  width:42px; height:42px;
  display:grid; place-items:center;
  font-weight:700;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
.marker-dot {
  width:12px; height:12px;
  border-radius:9999px;
  background:#2563eb;
  border:2px solid #1d4ed8;
  box-shadow:0 1px 3px rgba(0,0,0,.25);
}

/* a11y */
:focus-visible { outline: 2px solid #2563eb; outline-offset: 2px; }

.leaflet-marker-icon,
.leaflet-marker-shadow {
  background: transparent !important;
  border: none !important;
}

/* ---------- Header / Nav ---------- */
header,
[data-site-header] {
  position: relative;
  width: 100%;
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
  z-index: 5000;
}

header nav,
[data-site-nav] {
  display: flex; gap: 16px;
  white-space: nowrap;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
}
header nav a,
[data-site-nav] a {
  padding: 10px 0;
}

/* ===== FINAL LOCK: header / layout consistency ===== */
/* 既定のヘッダー高（必要に応じて 56/60/64 など） */
:root { --header-h: 64px; }

/* 常に最前面＆固定 */
header, [data-site-header]{
  position: fixed !important;
  top: 0 !important; left: 0 !important; right: 0 !important;
  height: var(--header-h) !important;
  background: #fff !important;
  border-bottom: 1px solid #e5e7eb !important;
  z-index: 2147483600 !important; /* ほぼ何より上 */
  -webkit-backface-visibility: hidden; backface-visibility: hidden;
  transform: translateZ(0);
}

/* 通常ページ本文は確実に押し下げ */
main, [data-page-root]{
  /* JS側が --cpm-header-h をセットするので、あればそれを優先 */
  padding-top: calc(var(--cpm-header-h, var(--header-h))) !important;
}

/* ---------- Map layout ---------- */
/* Map はヘッダー直下に固定＆はみ出し禁止 */
.map-screen{
  position: fixed !important;
  top: calc(var(--cpm-header-h, var(--header-h))) !important;
  left: 0; right: 0; bottom: 0;
  height: auto !important;
  overflow: hidden !important;
  z-index: 1 !important; /* ヘッダーより下 */
  border-top: 1px solid #e5e7eb;
}
.map-screen .leaflet-container{ height:100% !important; width:100% !important; }

/* ---------- z-index helpers ---------- */
.z-header{ z-index:50; }
.z-fab{ z-index:40; }
.z-sheet{ z-index:60; }
.z-backdrop{ z-index:55; }
.z-leaflet{ z-index:30; }
.z-credit{ z-index:20; }

/* ---------- Leaflet controls ---------- */
/* ※ MapShell.tsx がズーム位置を動的に切り替えるため、強制配置はしない
.leaflet-control-zoom { ... }  ← 削除
*/

/* Filters ボタン（必要なら） */
.leaflet-control.custom-filters {
  position: absolute !important;
  top: 12px !important;
  right: 12px !important;
  z-index: 1000 !important;
}

/* ---------- Credit badge ---------- */
.cpm-credit {
  position:absolute;
  right: 10px; bottom: 10px;
  padding: 2px 6px;
  background: rgba(255,255,255,.85);
  border-radius: 6px;
  font-size: 12px;
}

/* === Phase5 minimal additions === */
[data-badge] { letter-spacing: .01em; }
.cp-gallery img { aspect-ratio: 4/3; object-fit: cover; }

/* Popup text clamp & wrap */
.cp-popup { word-break: break-word; }
.cp-popup .line-clamp-2 {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
}
.cp-popup .line-clamp-3 {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 3;
  overflow: hidden;
}

/* ---------- Map toolbar (fixed filters) ---------- */
.map-toolbar{
  position: absolute;
  top: 8px;
  left: 8px;
  z-index: 1200;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: 10px;
  background: rgba(255,255,255,.92);
  backdrop-filter: saturate(140%) blur(6px);
  box-shadow: 0 4px 16px rgba(0,0,0,.12);
}
.map-toolbar select{
  font-size: 14px;
  padding: .25rem .5rem;
  border: 1px solid #d1d5db;
  border-radius: .5rem;
  background: #fff;
}
@tailwind base;
@tailwind components;
@tailwind utilities;
@import 'leaflet/dist/leaflet.css';

/* ---------- Leaflet pane ordering ---------- */
.leaflet-tile-pane      { z-index: 200 !important; }
.leaflet-overlay-pane   { z-index: 400 !important; }
.leaflet-marker-pane    { z-index: 600 !important; }
.leaflet-popup-pane     { z-index: 700 !important; }
.leaflet-top, .leaflet-bottom { z-index: 800 !important; }

/* ---------- Modal ---------- */
.cpm-backdrop {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 2000 !important;
}
.cpm-modal {
  position: fixed; right: 0; top: 0;
  height: 100vh; width: min(420px,100vw);
  background:#fff; z-index: 2100 !important;
  display:flex; flex-direction:column;
  box-shadow:-14px 0 40px rgba(0,0,0,.25);
}
.cpm-modal__header {
  padding: 14px 16px;
  border-bottom: 1px solid #eee;
  display:flex; align-items:center; justify-content:space-between;
}
.cpm-modal__body { padding: 12px 16px; overflow:auto; }

/* ---------- Clusters & markers ---------- */
.cluster-green  { background:#86efac; border:3px solid #22c55e; color:#14532d; }
.cluster-yellow { background:#fde68a; border:3px solid #f59e0b; color:#713f12; }
.cluster-orange { background:#fdba74; border:3px solid #f97316; color:#7c2d12; }
.cluster-red    { background:#fca5a5; border:3px solid #ef4444; color:#7f1d1d; }
.cluster {
  border-radius:9999px;
  width:42px; height:42px;
  display:grid; place-items:center;
  font-weight:700;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
.marker-dot {
  width:12px; height:12px;
  border-radius:9999px;
  background:#2563eb;
  border:2px solid #1d4ed8;
  box-shadow:0 1px 3px rgba(0,0,0,.25);
}

/* a11y */
:focus-visible { outline: 2px solid #2563eb; outline-offset: 2px; }

.leaflet-marker-icon,
.leaflet-marker-shadow {
  background: transparent !important;
  border: none !important;
}

/* ---------- Header / Nav ---------- */
header,
[data-site-header] {
  position: relative;
  width: 100%;
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
  z-index: 5000;
}

header nav,
[data-site-nav] {
  display: flex; gap: 16px;
  white-space: nowrap;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
}
header nav a,
[data-site-nav] a {
  padding: 10px 0;
}

/* ===== FINAL LOCK: header / layout consistency ===== */
/* 既定のヘッダー高（必要に応じて 56/60/64 など） */
:root { --header-h: 64px; }

/* 常に最前面＆固定 */
header, [data-site-header]{
  position: fixed !important;
  top: 0 !important; left: 0 !important; right: 0 !important;
  height: var(--header-h) !important;
  background: #fff !important;
  border-bottom: 1px solid #e5e7eb !important;
  z-index: 2147483600 !important; /* ほぼ何より上 */
  -webkit-backface-visibility: hidden; backface-visibility: hidden;
  transform: translateZ(0);
}

/* 通常ページ本文は確実に押し下げ */
main, [data-page-root]{
  /* JS側が --cpm-header-h をセットするので、あればそれを優先 */
  padding-top: calc(var(--cpm-header-h, var(--header-h))) !important;
}

/* ---------- Map layout ---------- */
/* Map はヘッダー直下に固定＆はみ出し禁止 */
.map-screen{
  position: fixed !important;
  top: calc(var(--cpm-header-h, var(--header-h))) !important;
  left: 0; right: 0; bottom: 0;
  height: auto !important;
  overflow: hidden !important;
  z-index: 1 !important; /* ヘッダーより下 */
  border-top: 1px solid #e5e7eb;
}
.map-screen .leaflet-container{ height:100% !important; width:100% !important; }

/* ---------- z-index helpers ---------- */
.z-header{ z-index:50; }
.z-fab{ z-index:40; }
.z-sheet{ z-index:60; }
.z-backdrop{ z-index:55; }
.z-leaflet{ z-index:30; }
.z-credit{ z-index:20; }

/* ---------- Leaflet controls ---------- */
/* ※ MapShell.tsx がズーム位置を動的に切り替えるため、強制配置はしない
.leaflet-control-zoom { ... }  ← 削除
*/

/* Filters ボタン（必要なら） */
.leaflet-control.custom-filters {
  position: absolute !important;
  top: 12px !important;
  right: 12px !important;
  z-index: 1000 !important;
}

/* ---------- Credit badge ---------- */
.cpm-credit {
  position:absolute;
  right: 10px; bottom: 10px;
  padding: 2px 6px;
  background: rgba(255,255,255,.85);
  border-radius: 6px;
  font-size: 12px;
}

/* === Phase5 minimal additions === */
[data-badge] { letter-spacing: .01em; }
.cp-gallery img { aspect-ratio: 4/3; object-fit: cover; }

/* Popup text clamp & wrap */
.cp-popup { word-break: break-word; }
.cp-popup .line-clamp-2 {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
}
.cp-popup .line-clamp-3 {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 3;
  overflow: hidden;
}

/* ---------- Map toolbar (fixed filters) ---------- */
.map-toolbar{
  position: absolute;
  top: 8px;
  left: 8px;
  z-index: 1200;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: 10px;
  background: rgba(255,255,255,.92);
  backdrop-filter: saturate(140%) blur(6px);
  box-shadow: 0 4px 16px rgba(0,0,0,.12);
}
.map-toolbar select{
  font-size: 14px;
  padding: .25rem .5rem;
  border: 1px solid #d1d5db;
  border-radius: .5rem;
  background: #fff;
}
