<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Report / Other Proposal — CryptoPayMap</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/forms/forms.css" />
  <style>
    /* submit中の簡易インジケータ（インデターミネイト） */
    .progress {
      height: 6px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      margin: 14px 0 6px;
      display: none;
    }
    .progress .bar {
      width: 40%;
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      border-radius: 999px;
      animation: ind 1.2s infinite ease-in-out;
    }
    @keyframes ind {
      0% { transform: translateX(-60%); }
      50% { transform: translateX(60%); }
      100% { transform: translateX(160%); }
    }
    .is-submitting .progress { display: block; }
    .is-submitting button[type="submit"] { opacity: .6; pointer-events: none; }
  </style>
</head>
<body>
<main class="container">
  <h1>Report / Other Proposal</h1>
  <p class="subtle">Images: up to <strong>4</strong>, ≤ <strong>2MB</strong> each. Evidence links are recommended.</p>

  <form id="form-report" action="/submit/report" method="post" enctype="multipart/form-data" class="form-col">
    <div class="progress" aria-hidden="true"><div class="bar"></div></div>

    <div class="field">
      <label class="required" for="sn">Submitter name</label>
      <input id="sn" name="SubmitterName" required minlength="2" maxlength="80" type="text" autocomplete="name">
    </div>

    <div class="field">
      <label class="required" for="se">Submitter email</label>
      <input id="se" name="SubmitterEmail" required type="email" autocomplete="email">
    </div>

    <div class="field">
      <label class="required" for="pr">Map URL or Place ID</label>
      <input id="pr" name="PlaceRef" required placeholder="https://cryptopaymap.vercel.app/place/xxxx" type="text" inputmode="url">
    </div>

    <div class="field">
      <label for="pn">Place name</label>
      <input id="pn" name="PlaceName" maxlength="80" type="text">
    </div>

    <div class="field">
      <label class="required" for="iss">Issue type</label>
      <select id="iss" name="Issue" required>
        <option value="">— Select —</option>
        <option>Closed</option><option>Wrong info</option><option>Duplicate</option>
        <option>Fraud</option><option>Other</option>
      </select>
    </div>

    <div class="field">
      <label class="required" for="det">Description / Details</label>
      <textarea id="det" name="Details" required maxlength="1000" placeholder="Describe the issue..."></textarea>
      <p class="help">Up to 1000 characters.</p>
    </div>

    <div class="field">
      <label for="ev">Evidence link(s)</label>
      <textarea id="ev" name="Evidence" placeholder="https://x.com/post/..., https://instagram.com/..."></textarea>
      <p class="help">Separate multiple URLs by commas or new lines.</p>
    </div>

    <div class="field">
      <label for="nc">New accepted crypto</label>
      <input id="nc" name="NewCoins" placeholder="USDT (Polygon)" type="text" maxlength="120">
    </div>

    <div class="field">
      <label for="op">Other proposal</label>
      <textarea id="op" name="OtherProposal" maxlength="800"></textarea>
    </div>

    <!-- ✅ 追加：自由記述（長文） -->
    <div class="field">
      <label for="notes">Reporter notes (optional)</label>
      <textarea id="notes" name="ReporterNotes" maxlength="1000" placeholder="Context / background / anything helpful for reviewers..."></textarea>
      <p class="help">Optional. Up to 1000 characters.</p>
    </div>

    <div class="field">
      <label>🖼️ Upload evidence images — gallery (up to 4)</label>
      <input id="galleryR" name="Gallery[]" type="file" accept="image/jpeg,image/png,image/webp" multiple />
      <p class="help">Images only (JPEG/PNG/WEBP). ≤2MB each. First image becomes cover.</p>
    </div>

    <div class="field">
      <label for="ce">Contact email (optional)</label>
      <input id="ce" type="email" name="Contact">
    </div>

    <div class="field inline-check">
      <input id="consent" name="Consent" type="checkbox" required />
      <label class="required" for="consent" style="font-weight:400">
        I confirm the information is accurate and I grant a non-exclusive free license to display the content.
      </label>
    </div>

    <div class="btnrow">
      <button class="btn" type="submit">Submit</button>
      <a class="btn secondary" href="/forms/owner.html">Switch to Owner</a>
      <a class="btn secondary" href="/forms/community.html">Switch to Community</a>
    </div>
  </form>
</main>

<script>
(function(){
  function onReady(fn){ if(document.readyState==='loading') document.addEventListener('DOMContentLoaded',fn); else fn(); }
  onReady(function(){
    // prefill placeId / placeName from query (同一ロジックを簡略化して維持)
    const sp = new URLSearchParams(location.search);
    const placeId   = sp.get('placeId') || sp.get('place_id') || '';
    const placeName = sp.get('placeName') || sp.get('place_name') || '';
    const $ = s => document.querySelector(s);
    if(placeName) $('#pn') && ($('#pn').value = placeName);
    if(placeId)   $('#pr') && ($('#pr').value = placeId);

    // submit時の簡易プログレス表示（ページ遷移までの間にバーを動かす）
    const form = document.getElementById('form-report');
    form.addEventListener('submit', function(){
      form.classList.add('is-submitting');
    }, { passive: true });
  });
})();
</script>
</body>
</html>
